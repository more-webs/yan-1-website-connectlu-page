<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>YAN_1 CONNECTLU</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      background: #020617;
      color: #e5e7eb;
      font-family: system-ui, sans-serif;
      padding: 20px;
    }

    h1 { 
      margin-bottom: 10px; 
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .home-link {
      font-size: 28px;
      cursor: pointer;
      text-decoration: none;
      color: #38bdf8;
    }

    /* Search bar */
    .search-bar {
      display: flex;
      gap: 10px;
      margin: 15px 0;
      max-width: 500px;
    }

    .search-bar input {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #334155;
      background: #0f172a;
      color: #e5e7eb;
    }

    .search-bar button {
      padding: 10px 16px;
      border-radius: 8px;
      border: none;
      background: #38bdf8;
      color: #020617;
      cursor: pointer;
      font-weight: 600;
    }

    .search-bar button.back {
      background: #475569;
      color: #e5e7eb;
    }

    /* Profile area */
    .profile-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      margin: 20px 0;
      text-align: center;
    }

    .profile-top {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .profile-area img {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #334155;
      box-shadow: 0 0 20px rgba(255,255,255,0.15);
      background: #0f172a;
      cursor: pointer;
    }

    .share-btn {
      font-size: 26px;
      cursor: pointer;
      user-select: none;
    }

    .share-btn:hover { color: #38bdf8; }

    .meta {
      max-width: 520px;
    }

    .meta .username {
      font-weight: 700;
      font-size: 18px;
    }

    .meta .fullname {
      color: #94a3b8;
    }

    .meta .bio {
      margin-top: 6px;
      font-size: 14px;
      color: #cbd5f5;
    }

    /* Fullscreen viewer */
    .fullscreen {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .fullscreen img {
      max-width: 90%;
      max-height: 90%;
      border-radius: 12px;
    }

    .close-btn {
      position: absolute;
      top: 20px;
      right: 30px;
      font-size: 44px;
      font-weight: bold;
      cursor: pointer;
      color: #7f1d1d;
    }

    .close-btn:hover { color: #dc2626; }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      min-width: 600px;
    }

    th, td {
      border: 1px solid #334155;
      padding: 10px;
      vertical-align: top;
    }

    th { background: #0f172a; }
    tr:nth-child(even) { background: #020617; }

    a {
      color: #38bdf8;
      text-decoration: none;
      word-break: break-all;
    }

    a:hover { text-decoration: underline; }

    /* ================= MOBILE OPTIMIZATION (ADDED) ================= */

    .table-wrapper {
      width: 100%;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    @media (max-width: 768px) {
      th, td {
        padding: 6px 8px;
        font-size: 13px;
        line-height: 1.3;
      }

      h1 {
        font-size: 20px;
      }

      .profile-area img {
        width: 90px;
        height: 90px;
      }

      .meta .username {
        font-size: 16px;
      }

      .meta .bio {
        font-size: 13px;
      }
      
      /* Fix for mobile fullscreen image positioning */
      .fullscreen {
        display: flex;
        align-items: center;
        justify-content: center;
      }
    }
  </style>
</head>
<body>

<h1>
  <a href="https://yan-shun-081.github.io/yan-1-website.com/" class="home-link">üè†</a>
  ‚≠ê YAN_1 CONNECTLU
</h1>

<div class="search-bar">
  <input type="text" id="searchInput" placeholder="Search by username or full name">
  <button id="searchBtn">Search</button>
  <button id="backBtn" class="back" style="display:none">Back</button>
</div>

<div class="profile-area" id="profileArea"></div>

<div class="fullscreen" id="fullscreenViewer">
  <span class="close-btn" onclick="closeFullscreen()">‚úï</span>
  <img id="fullscreenImg">
</div>

<!-- TABLE WRAPPED (ONLY CHANGE IN HTML) -->
<div class="table-wrapper">
  <table id="sheetTable"></table>
</div>

<script>
const sheetURL =
  "https://docs.google.com/spreadsheets/d/1_iIQHZNzO5XOzYonKg_sm7JdoS3cgJdW4wHYroLcbKk/gviz/tq?tqx=out:csv";

const pageBaseURL =
  "https://more-webs.github.io/yan-1-website-connectlu-page/page1.html";

let originalRows = [];

function extractDriveFileId(url) {
  const match = url.match(/[-\w]{25,}/);
  return match ? match[0] : null;
}

function openFullscreen(src) {
  fullscreenImg.src = src;
  fullscreenViewer.style.display = "flex";
}

function closeFullscreen() {
  fullscreenViewer.style.display = "none";
}

function shareLink(codeValue) {
  const url = `${pageBaseURL}?code=${encodeURIComponent(codeValue)}`;
  navigator.share ? navigator.share({ title:"ConnectLU Profile", url }) :
    navigator.clipboard.writeText(url);
}

function render(rows, headers) {
  profileArea.innerHTML = "";
  sheetTable.innerHTML = "";

  const profileCol = headers.findIndex(h => h.toLowerCase().includes("profile"));
  const codeCol = headers.findIndex(h => h.toLowerCase() === "code");
  const usernameCol = headers.findIndex(h => h.toLowerCase().includes("username"));
  const fullnameCol = headers.findIndex(h => h.toLowerCase().includes("full"));
  const bioCol = headers.findIndex(h => h.toLowerCase().includes("bio"));

  if (rows.length) {
    const r = rows[0];
    const top = document.createElement("div");
    top.className = "profile-top";

    const fileId = extractDriveFileId(r[profileCol]);
    if (fileId) {
      const img = document.createElement("img");
      img.src = `https://drive.google.com/thumbnail?id=${fileId}&sz=w600`;
      img.onclick = () => openFullscreen(img.src);
      top.appendChild(img);
    }

    const share = document.createElement("span");
    share.className = "share-btn";
    share.textContent = "·Øì‚û§";
    share.onclick = () => shareLink(r[codeCol]);
    top.appendChild(share);

    profileArea.appendChild(top);

    const meta = document.createElement("div");
    meta.className = "meta";
    meta.innerHTML = `
      <div class="username">@${r[usernameCol] || ""}</div>
      <div class="fullname">${r[fullnameCol] || ""}</div>
      <div class="bio">${r[bioCol] || ""}</div>
    `;
    profileArea.appendChild(meta);
  }

  const trh = document.createElement("tr");
  headers.forEach((h,i)=>{
    if(i!==profileCol){
      const th=document.createElement("th");
      th.textContent=h;
      trh.appendChild(th);
    }
  });
  sheetTable.appendChild(trh);

  rows.forEach(row=>{
    const tr=document.createElement("tr");
    row.forEach((cell,i)=>{
      if(i===profileCol) return;
      const td=document.createElement("td");
      if(cell.includes("@")) td.innerHTML=`<a href="mailto:${cell}">${cell}</a>`;
      else if(cell.startsWith("http")) td.innerHTML=`<a href="${cell}" target="_blank">${cell}</a>`;
      else td.textContent=cell;
      tr.appendChild(td);
    });
    sheetTable.appendChild(tr);
  });
}

fetch(sheetURL)
  .then(r=>r.text())
  .then(csv=>{
    const rows=csv.trim().split("\n").map(r=>r.split(",").map(c=>c.replace(/"/g,"").trim()));
    const headers=rows.shift();
    originalRows=[...rows];
    render(rows,headers);

    searchBtn.onclick=()=>{
      const q=searchInput.value.toLowerCase();
      const filtered=originalRows.filter(r=>r.join(" ").toLowerCase().includes(q));
      backBtn.style.display="inline-block";
      render(filtered,headers);
    };

    backBtn.onclick=()=>{
      backBtn.style.display="none";
      searchInput.value="";
      render(originalRows,headers);
    };
  });
</script>

</body>
</html>
